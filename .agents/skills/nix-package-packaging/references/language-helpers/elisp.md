# Elisp Helpers

Sources:
- https://wiki.nixos.org/wiki/Language-specific_package_helpers

## Native-First Baseline

- Prefer existing nixpkgs Emacs packaging patterns first.
- Use helper generation when many Elisp dependencies must be translated repeatedly.

## Decision Playbook

| Signal | Action |
|---|---|
| Single package with simple dependency graph | package directly using existing nixpkgs Emacs conventions |
| Repeated updates across many Elisp deps | generate with helper, then review generated expressions |
| Generated output needs frequent manual edits | stop generation-first workflow and return to direct packaging |

## Helper

- `emacs2nix` - Automatically generate Nix expressions for Emacs packages. Upstream: https://github.com/ttuegel/emacs2nix

## Failure Signatures and Fixes

- Signature: generated package set drifts from current nixpkgs naming/layout.
  - First fix: align generated attr names and call paths to current Emacs package-set conventions.
  - Second fix: reduce generation scope to only high-churn dependencies.
- Signature: helper output changes heavily between small dependency updates.
  - First fix: pin helper/tool inputs for stable generation.
  - Second fix: switch to hand-maintained expressions for low-churn deps.

## Abandon Helper When

- Generated diffs are consistently noisier than the functional changes.
- Most helper output needs manual patching each release.

## Example Implementation

```nix
{ pkgs, ... }:
let
  # Generated by emacs2nix workflow in repo tooling.
  emacsPackagesGenerated = import ./emacs-packages-generated.nix { inherit pkgs; };
in
emacsPackagesGenerated.my-elisp-package
```
