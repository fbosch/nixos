# ❄️ NixOS

<a href="https://github.com/mightyiam/dendritic"> <img src="https://img.shields.io/badge/Dendritic--Pattern-Nix-informational?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAA5CAYAAAB0+HhyAAAAAXNSR0IB2cksfwAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAbpJREFUaN7tWcGuwyAMW6L9/y/nXTZpr4PiJA6sqJwmrZQYjOOk8igcZmbv3yIilWvpY9L4BHVpINXjBnIDKRrP1arEUjZlgIiokr0GS9mo1GoFN0uKJUMBdkCt96J00wyt5DUYALLv0ch96O3kCgD0O+INqvdslK5ypApLJnsBjea25o1Ai4gIOvH4XARMdAOO81rPaEWOYCiXB8RpZkfoNtPuDwUnsusoOBa1kFg0ojozqYaqpLJywioAp5cdOZ2KU8kkXmEEiiY3RhLsvYObXQdSiUppZC312HAm3bL+7WuToi9F5rROpGotyfgi5qXP+jeJJi4mIM96PS8mTEsSzcrZ4s5V6s7KB+mafYsT2eaObKtal80jmeDOAjmjLHutbbzW3u63zNglTae7HkF2aGY7CFlbq0DM7rQoWov8WvPhGK9mi6mK5oKnf/CO/flr9Bm5jNb/ZmaK7soqkKhg6L/sCDbpop/XmL7sK+6M48wIAfMTRrdBN6MeiTar3Q06zy5lKTMyk8ipbPNVt6SsHXVnKvKWsncUokGBfCuD15HgWqAzAEsTG6OpsYRaK8cN5AZyRSAzXfIf7j4IjUJ5XtMAAAAASUVORK5CYII=&logoColor=white" alt="Dendritic Pattern"/></a>
<a href="https://flake.parts/"><img src="https://img.shields.io/badge/Flake%20Parts-Nix-informational?logoSize=auto&logoColor=white&logo=data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iMzcuMzcyOTFtbSIKICAgaGVpZ2h0PSI0NS4zMTE5NzRtbSIKICAgdmlld0JveD0iMCAwIDM3LjM3MjkwOSA0NS4zMTE5NzMiCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzExNTIiCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGRlZnMKICAgICBpZD0iZGVmczExNDkiIC8+CiAgPGcKICAgICBpZD0ibGF5ZXIxIgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zOS4xMTkzNDksLTExMy4yMDM5OCkiPgogICAgPHBhdGgKICAgICAgIGlkPSJwYXRoNDg5OCIKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjcuOTM3O3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZSIKICAgICAgIGQ9Im0gNDYuNTkzODI4LDExMy4yMDM5OCAtMy43MzcyNCw2LjQ3Mjk5IDcuNDc0NDc5LDEyLjk0NTk4IC03LjQ3NDQ3OSwxMi45NDY1IC0zLjczNzIzOSw2LjQ3Mjk5IDMuNzM3MjM5LDYuNDczNTEgaCA3LjQ3NDQ3OSBsIDcuNDc0NDc5LC0xMi45NDY1IDcuNDc0OTk2LDEyLjk0NjUgaCA3LjQ3NDQ3OSBsIDMuNzM3MjQsLTYuNDczNTEgLTMuNzM3MjQsLTYuNDcyOTkgLTcuNDc0NDc5LC0xMi45NDY1IC03LjQ3NDk5NiwtMTIuOTQ1OTggLTMuNzM3MjM5LC02LjQ3Mjk5IHoiIC8+CiAgPC9nPgo8L3N2Zz4K&link=https://flake.parts/" alt="Flake Parts" /></a>
<a href="https://nixos.org"><img alt="NixOS" src="https://img.shields.io/badge/NixOS-5277C3?logo=nixos&logoColor=fff" /></a>
<a href="https://github.com/nix-darwin/nix-darwin"> <img src="https://img.shields.io/badge/Nix--Darwin-5277C3?logo=apple&logoColor=fff" alt="Dendritic Pattern"/></a>
<a href="https://github.com/nix-community/home-manager"> <img src="https://img.shields.io/badge/Home--Manager-Nix-informational?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAAXNSR0IB2cksfwAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAMAQAADAEB9phnUAAAAAd0SU1FB+kMDxInMm28iUYAAARGSURBVGje7ZldiFVVFMf/646j5lRIGakN2oA2TWFhYfYd81AJQhDTByaIlJJCRUElZZ+UpfXQQxREiVEhKBiID1kpOqE9RA4p6VDJmEJkRFbTVDPNx6+XPXQ47X3uveeefbkPLrgP9+z1sf97r73O2v8jnZbGEqvFGOiS1CqpJKnbzHoCehMlLZPU5H4l9ztpZlsDNoslzXZ/95rZkSgrAMwDhvlPjgATMvQ/4P8yAsz36M4FhhJ6XwKlGCAM2OWZ2IMZNq3AgMdmL2Ap3R0evftiACkBPZ5gvwDnZNg9jV/uSOgsCui8Giu1bgwEfD3D5gzgmMemD5gMNAO9nvGfgKnRKgWw1RN0GLgkw+bOwAI8ATwSGFsRteQBFwJ/ewLvLHO+uj02/cCvnucHohx0z8TWBVZxcYbNfFexyskYcF2h7xGgRVKL+zs2/ljSFEk9kqalTL6R1ClpxOkpYYukDZJWlgm72cyWFl2lDlCsrAJ+yxgfAFqLTp/lFC99wNqM8aeqmWOpwpRaF+F4tUma6FIwLWOS3ip6N54nngwA9wfGXi6saQRmSjrsDnQs2SxpuqRFqeeDki41s77o3a8De6akJc5X0t/3ZvZxhT4ulnRIUnNq6EMz66rLPQBYH0iNW6v081rAT2c9QMwBBj3Bd+TwNRX42ePrK6ApNpDtnsBDwEU5/a0K7MrCmCBuKbrdBpqAgyl/u9P3lSJBNAOHPSBOAmfX6LszdYO8rBK7CZ5yuzzRR+HprSSpQ5KvVV9rZv01kQhme4BtkrokvWNmh/Ksxvs1vNwKa7eBNuBH4Lw8xte4tjmvXF9w+rbl7bXOreEFuUXSiUJ5KrNjtazCzhw78SewOhplk6fXAtolrQ7s2AJJV3t8vOQOZrukFWa2sWHpSGAS8J1nN06k7hQ1l9/YQNYE0uohD2HwSqOCmOEYjrTsA17wPB8E5jYikHc9kx0FrnT8r48N2d5oIBa6SadlY0LnjUDa3dxIQN72TPB3YHpCZxpwyqP3dRY7X28g7Sl6H+Axj97DgV15EjjufMT6fVIpmA2JiX0LTAp0w70Bdv7RiOTFKHBFpUDOAn5whrdl6N0bCPYm8EUkIJuqTbGl5bYQ+CwQbBhYWWNDGqKSZlYLxIALMsbvLhP00xqvCD55pmg6aIqkXkmzyqjeJWmXi1lKzaFD0h4P87nNEd2lxFzHdU6Z2UiRle25ClfwKDC5ylI/ClxVj/I8C/grUK18sibD1/nuHZWWz6ORD4ngWwIfZ64NfIboB2Zk+Hs8sAD3xARxUyDoe278hkCl2lTmunA0cF1oiQGi5OGfAP5IlsTAjo0CCzJ83x5YoGdj7chHvi+zKZ3ZgTO0PyvvHSmXlgdiAekA/klVJV/78mK1eQ9cnroelG1Ac3enZtYLLJM0xz3abWZDHtX1koYThB+O8GvK8H0QWCJpPE27C31nnJY6yL9F+cbMnhkZewAAAABJRU5ErkJggg==&logoColor=white" alt="Home Manager"/></a>

Personal NixOS configuration using a dendritic module layout with flake-parts.

**Quick Start:**

```sh
nh os switch          # Build and switch
nh os test            # Test without switching
nh os switch --update # Update and rebuild
```

**Hosts:** rvn-pc, rvn-srv, rvn-vm

Fresh installation? See [docs/INSTALLATION.md](docs/INSTALLATION.md).

## Common Tasks

> **Note:** This configuration uses [`nh`](https://github.com/nix-community/nh) (Nix Helper) for simplified system management.

### Manage Dotfiles

My dotfiles (https://github.com/fbosch/dotfiles) are applied via Home Manager using GNU Stow.

The repository is **initially pinned** to a specific ref for reproducibility. When actively iterating on dotfiles:

1. Switch to the default branch in the dotfiles repo
2. Make changes and test
3. When stable, pin to a new commit in `flake.nix`

This keeps dotfiles consistent across Nix and non-Nix hosts.

### Update Dependencies

```sh
# Update and rebuild in one command
nh os switch --update

# Or update without rebuilding
nix flake update
```

### Clean Up Old Generations

```sh
nh clean all  # Auto-cleanup (keeps last 15 or from last 7 days)
```

### Search Packages

```sh
nh search <package-name>
```

### Lint & Format

```sh
nix run .#lint   # statix + deadnix checks
nix run .#fmt    # nixpkgs-fmt formatting
```

## Layout

```text
assets/            screenshots and art
configs/           shared config files (gpg, etc)
docs/              guides and agent docs
lib/               pure utility functions
  icon-overrides.nix    icon theme customization
machines/          machine-specific NixOS configs
  desktop/         desktop machine hardware config
  msi-cubi/        MSI Cubi hardware config
  virtualbox-vm/   VirtualBox VM config
modules/
  flake-parts/     meta, overlays, hosts loader, lib wiring
  hosts/           one file per machine → nixosConfigurations.<name>
  presets/         desktop, server presets
  applications/    GUI apps (browsers, gaming, file management)
  desktop/         desktop environment (hyprland, gtk, audio)
  development/     dev tools (git, nodejs, python, ai)
  hardware/        hardware-specific (fingerprint, storage, fancontrol)
  services/        system services (plex, home-assistant, attic)
  shell/           shell tools (fish, starship, direnv, eza)
  system/          system config (ananicy, scheduled-suspend)
  virtualization/  docker, libvirt
  *.nix            core modules (users, fonts, security, nas, sops)
pkgs/by-name/      local packages
scripts/           helper scripts
secrets/           sops files
```

```mermaid
flowchart LR
  flake[flake.nix]
  meta[flake.meta]
  modules[flake.modules]
  libResolvers[flake.lib.resolve*]
  presets[presets/]

  subgraph pureLib[lib/]
    iconOverrides[icon-overrides.nix]
  end

  subgraph moduleTree[modules/]
    hosts[hosts/*]
    presetsModules[presets/*]
    moduleset[feature modules]
  end

  machines[machines/*]

  flake --> meta
  flake --> modules
  flake --> libResolvers
  flake -.imports.-> pureLib

  modules --> moduleTree
  moduleTree --> presetsModules

  hosts --> libResolvers
  hosts --> machines
  presetsModules --> libResolvers

  libResolvers -.uses.-> iconOverrides
  libResolvers --> modules

  libResolvers --> nixosConfigs[nixosConfigurations]
  libResolvers --> darwinConfigs[darwinConfigurations]
```

## Module wiring

Modules are resolved using helpers from `flake.lib`:

- `config.flake.lib.resolve [ "module-name" ]` - Resolves NixOS modules
- `config.flake.lib.resolveHm [ "module-name" ]` - Resolves Home Manager modules
- `config.flake.lib.resolveDarwin [ "module-name" ]` - Resolves Darwin modules

## Presets

Presets are reusable module bundles that provide a baseline configuration:

**Available:**

- `presets/desktop` - Full desktop environment with Hyprland, GUI apps, development tools
- `presets/server` - Minimal server configuration

## Credits

- Dendritic pattern — https://vic.github.io/dendrix/
- Inspiration — https://github.com/MrSom3body/dotfiles
- Inspiration — https://github.com/drupol/infra
- Fastfetch ANSI art — https://github.com/4DBug/nix-ansi

---

_Last reviewed: January 2026_
